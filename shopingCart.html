<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
    <title>Shopping Cart</title>
</head>

<body>
    <div style="width:90%" class="container-fluid">
        <br>
        <div class="row">

            <div class="col-md-9 cart-shoes-wrapper">
           
            </div>

            <script type="text/x-template" class="cart-shoes-template" >
                {{#each this}}
                <div style="margin-bottom: 2rem;" class="row">
                    <div class="col-5">
                        <div class="row">
                            <div class="col-6">
                                <img style="width: 150px;height: 110px;" class="img-fluid" src="{{this.image}}" alt="image">
                            </div>
                            <div class="col-6">
                                <h5>{{this.title}}</h5>
                                <small style="margin: 0;" >{{this.brand}}</small>
                                <p style="margin: 0;"> Size : {{this.size}}</p>
                                <p style="margin: 0;">color : {{this.color}}</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-7">
                        <div style="width:100%" class="shoe-details">
                           <table style="width: 100%;padding: 1rem;">
                            <tr style="background-color: rgb(224, 224, 224);" >
                                <td>
                                    Quantity
                                </td>
                                <td>
                                    Price
                                </td>
                                <td>
                                    Total
                                </td>
                            </tr>

                            <tr>
                                <td style="padding: 0.7rem;" >
                                    <button style="border: none;background: none;" onclick="quantityDOM('decrease',{{this.id}},{{this.quantity}})" class="btn btn-outline-secondary btn-sm" >  
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-caret-left-fill text-dark" viewBox="0 0 16 16">
                                            <path d="m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z"/>
                                        </svg>
                                    </button> 

                                    <span  item="6" class="quantity-counter-{{this.id}}" style="padding: 0.5rem 0.8rem 0.5rem 0.8rem ;border: 1px rgb(198, 198, 198) solid; " > {{this.buyQuantity}} </span>

                                    <button style="border: none;background: none;" onclick="quantityDOM('increase',{{this.id}},{{this.maximumItems}})" class="btn btn-outline-secondary btn-sm" > 
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-caret-right-fill text-dark" viewBox="0 0 16 16">
                                            <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
                                          </svg>
                                     </button>
                                </td>
                                <td>
                                    R {{this.price}}
                                </td>
                                <td>
                                    R {{this.total}}
                                </td>
                            </tr>

                           </table>
                        </div>
                    </div>
                </div>
                {{/each}}

            </script>

            <div class="col-md-3 cart-summery  ">
                <div style="height: 100%;background-color: rgb(235, 235, 235);padding: 1rem;" >
                    <center>
                        <br>
                        <h5> Order Summer</h5>
                        <hr>
                        <h6>Items : 3</h6>
                        <br>
                        <br>
                        <br>
                        <button style="border-radius: 0;"  onclick="buyButtonClicked()" class="btn btn-dark" href="#">Checkout</button>
                    </center>
                </div>
            </div>
            
        </div>
    </div>
    


    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="js/shoe-data.js"></script>
    <script src="js/shopingCart.js"></script>
    <script>

        let shoppingCartInstance = shoppingCart() ;

        let cartArr = [];
        if(localStorage["cart-shoes"]){
            cartArr = JSON.parse(localStorage["cart-shoes"])
        }

        const cartShoesWrapperElem = document.querySelector(".cart-shoes-wrapper") ;
        const cartShoesTemplate = document.querySelector(".cart-shoes-template").innerHTML ;

        let compiledCartShoesTemplate = Handlebars.compile(cartShoesTemplate);

        cartShoesWrapperElem.innerHTML = compiledCartShoesTemplate(cartArr)

        

        function quantityDOM(action, shoeId, max){
            let quantityCounterElem = document.querySelector(`.quantity-counter-${shoeId}`);

            if (action === "increase" && Number(quantityCounterElem.innerHTML) < max){
                quantityCounterElem.innerHTML = Number(quantityCounterElem.innerHTML) + 1 ;
                shoppingCartInstance.updateStockQuantity(shoeId, Number(quantityCounterElem.innerHTML), action ) ;

            }else if(action === "decrease" && Number(quantityCounterElem.innerHTML) >= 1 ){
                quantityCounterElem.innerHTML = Number(quantityCounterElem.innerHTML) - 1 ;
                shoppingCartInstance.updateStockQuantity(shoeId, Number(quantityCounterElem.innerHTML), action );

            }
        }


        function buyButtonClicked(){
            shoppingCartInstance.buyFunction()
        }

    </script>
</body>

</html>